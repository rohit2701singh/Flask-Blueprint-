{% extends "base.html" %}

{% block style %}
	<link href="{{ url_for('static', filename='css/posts.css') }}" rel="stylesheet" />
{% endblock style %} 

{% block content %}

	<div class="container mt-4">
		<!-- Profile Header (Only if logged in) -->
		{% if current_user.is_authenticated %}
		<div class="profile-header d-flex align-items-center p-3 mb-4 rounded shadow-sm">
			<img src="{{ url_for('static', filename='profile_pics/' + current_user.image_file) }}" alt="Profile Image" 
				class="profile-img rounded-circle me-3">
			<div>
				<h5 class="mb-0 d-flex align-items-center">
					{{ current_user.username }}
					<a href="{{ url_for('users.account') }}" 
					class="text-muted" 
					title="Edit Profile">
						<i class="fa fa-pencil"></i>
					</a>
				</h5>
				<small class="text-muted">{{ current_user.email }}</small>
				<div>
					<a href="{{ url_for('users.user_posts', username=current_user.username) }}" 
						class="text-decoration-none small text-primary">
						My Posts
					</a>
				</div>
    		</div>
		</div>
		{% else %}
			<h2 class="text-center mb-4">All Posts</h2>
		{% endif %}

		<!-- Show message if no posts exist -->
		{% if posts.items | length == 0 %}
			<div class="alert alert-info text-center py-4">
				{% if current_user.is_authenticated %}
					No posts yet. Be the first to <a href="{{ url_for('posts.new_post') }}">write one! <i class="fa fa-pencil ms-2"></i></a>
				{% else %}
					There are no posts yet.
				{% endif %}
			</div>
		{% else %}
			<!-- Posts Section -->
			{% for post in posts.items %}
				<div class="post-card p-4 mb-4 rounded shadow-sm">

					<!-- User Info + Time -->
					<div class="d-flex align-items-center mb-3">
						<img src="{{ url_for('static', filename='profile_pics/' + post.author.image_file) }}" alt="User Image"
							class="post-user-img rounded-circle me-3">
						<div>
							<h6 class="mb-0">
								<a href="{{ url_for('users.user_posts', username=post.author.username) }}" 
								class="text-decoration-none text-dark">
									{{ post.author.username }}
								</a>
							</h6>
							<small class="text-muted">{{ post.date_posted.strftime('%B %d, %Y at %I:%M %p') }}</small>
						</div>
					</div>

					<!-- Post Title + Edit Icon -->
					<div class="d-flex align-items-center">
						<h5 class="post-title mb-0">
							<a href="{{ url_for('posts.post_details', post_id=post.id) }}" class="text-decoration-none">
								{{ post.title }}
							</a>
						</h5>

						{% if current_user == post.author %}
							<a href="{{ url_for('posts.update_post', post_id=post.id) }}" 
							class="text-muted ms-2" title="Edit Post">
								<i class="fa fa-edit"></i>
							</a>
						{% endif %}
					</div>

					<!-- Post Content -->
					<div class="post-content mb-3">
						{{ post.content|safe }}
					</div>

					<!-- Like / Comment Buttons -->
					<div class="d-flex gap-3">
						<button class="btn btn-sm btn-outline-primary">
                        	<i class="fa fa-thumbs-up"></i> Like
						</button>
						<button class="btn btn-sm btn-outline-secondary">
							<i class="fa fa-comments"></i> Comment
						</button>
					</div>
				</div>
			{% endfor %}
		{% endif %}

		<!-- Pagination -->
		<div class="container text-center">
			{% for page_num in posts.iter_pages(left_edge=1, left_current=1, right_current=1, right_edge=1) %} 
				{% if page_num %} 
					{% if page_num == posts.page %}
						<a class="btn btn-info btn-md" href="{{ url_for('posts.all_posts', page=page_num) }}">{{ page_num }}</a>
					{% else %}
						<a class="btn btn-outline-info btn-sm" href="{{ url_for('posts.all_posts', page=page_num) }}">{{ page_num}}</a>
					{% endif %} 
				{% else %} 
				..... 
				{% endif %} 
			{% endfor %}
		</div>

	</div>

{% endblock content %}